<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Provider Earnings</title>
    <link rel="stylesheet" href="/styles/earnings.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo-brand">
            <img src="/public/images3/logo2.jpg" alt="Logo" class="logo">
            <span class="brand">AutoCustomizer</span>
        </div>
        <a href="#" class="menu-btn" onclick="toggleSidebar()">â˜°</a>
        <div class="nav-links" id="navLinks">
            <a href="/service/dashboardService.html">Dashboard</a>
            <a href="/service/profileSettings.html">Profile Settings</a>
            <a href="/service/bookingManagement">Booking Management</a>
            <a href="/service/reviews.html">Reviews & Ratings</a>
            <a href="/logout">Logout</a>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a class="close-btn" onclick="toggleSidebar()">Close Ã—</a>
        <a href="/service/dashboardService.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="/service/profileSettings.html"><i class="fas fa-user-cog"></i> Profile Settings</a>
        <a href="/service/bookingManagement"><i class="fas fa-calendar-alt"></i> Bookings</a>
        <a href="/service/customerCommunication"><i class="fas fa-comments"></i> Communication</a>
        <a href="/service/earnings" class="active"><i class="fas fa-money-bill-wave"></i> Earnings</a>
        <a href="/service/reviews.html"><i class="fas fa-star"></i> Reviews</a>
        <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <!-- Main Content -->
    <div class="earnings-container">
        <h1>ðŸ’° Earnings & Payouts</h1>

        <!-- Earnings Summary Cards -->
        <div class="earnings-summary">
            <div class="summary-card">
                <h2>Today's Earnings</h2>
                <p id="todaysEarnings">â‚¹0</p>
            </div>
            <div class="summary-card">
                <h2>This Month</h2>
                <p id="monthlyEarnings">â‚¹0</p>
            </div>
            <div class="summary-card">
                <h2>Total Earnings</h2>
                <p id="totalEarningsCard">â‚¹0</p>
            </div>
        </div>

        <!-- Earnings Graph Section -->
        <div class="earnings-graph">
            <h2>Earnings Breakdown</h2>
            <div class="graph-controls">
                <label for="timeRange">View:</label>
                <select id="timeRange" onchange="updateChart()">
                    <option value="1">Current Month (Weekly)</option>
                    <option value="6">Last 6 Months</option>
                    <option value="12">Last 12 Months</option>
                </select>
            </div>
            <div class="total-earnings" id="totalEarnings">Total Earnings: â‚¹0</div>
            <canvas id="earningsChart"></canvas>
        </div>

        <!-- Payout History -->
        <div class="payout-history">
            <h2>Payout History</h2>
            <table id="payoutTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="payoutBody">
                    <tr>
                        <td colspan="4" style="text-align: center;">Loading payout history...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/scripts/earnings.js"></script>

    <script>
        // Toggle sidebar function
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        // Load payout history
        async function loadPayoutHistory() {
            try {
                const response = await fetch('/service/api/earnings-data?timeRange=1');
                if (response.ok) {
                    const data = await response.json();
                    // For now, we'll show a message that history will be loaded from database
                    const tbody = document.getElementById('payoutBody');
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Payout history will be available after transactions are processed.</td></tr>';
                }
            } catch (error) {
                console.error('Error loading payout history:', error);
            }
        }

        // Update monthly earnings
        async function updateMonthlyEarnings() {
            try {
                const response = await fetch('/service/api/earnings-data?timeRange=1');
                if (response.ok) {
                    const data = await response.json();
                    const monthlyTotal = data.data.reduce((sum, val) => sum + val, 0);
                    document.getElementById('monthlyEarnings').textContent = `â‚¹${monthlyTotal.toLocaleString()}`;
                    document.getElementById('totalEarningsCard').textContent = `â‚¹${data.totalEarnings.toLocaleString()}`;
                }
            } catch (error) {
                console.error('Error updating monthly earnings:', error);
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadPayoutHistory();
            updateMonthlyEarnings();
        });
    </script>
</body>
</html>
