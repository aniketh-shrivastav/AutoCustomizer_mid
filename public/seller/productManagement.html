<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Management | Seller</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link href="/Css/CStyle.css" rel="stylesheet" />
    <link href="/newstyle.css" rel="stylesheet" />
    <link href="/Css/sellerBase.css" rel="stylesheet" />
    <style>
      /* General Styles (kept from original EJS for visual parity) */
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
        color: #333;
        margin: 0;
        padding: 0;
        line-height: 1.6;
      }
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

      header {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: white;
        padding: 30px 20px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      header h1 {
        margin: 0;
        font-size: 2.2em;
        font-weight: 600;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .container > h1:first-of-type {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: rgb(72, 70, 70);
        padding: 20px;
        margin: -20px -20px 30px -20px;
        width: calc(100% + 40px);
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        font-size: 2rem;
        font-weight: 700;
        position: relative;
        left: 0;
      }

      h2 {
        color: #6a11cb;
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 600;
      }

      .product-form {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 25px;
        margin-bottom: 30px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .product-form:hover {
        transform: translateY(-6px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #6a11cb;
      }
      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
        box-sizing: border-box;
        transition: border-color 0.3s ease;
        font-family: "Poppins", sans-serif;
      }
      .form-group input:focus,
      .form-group textarea:focus {
        border-color: #6a11cb;
        outline: none;
        box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
      }
      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn-add {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 1em;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .btn-add:hover {
        background: linear-gradient(135deg, #5c0fb3, #2169e8);
        transform: translateY(-1px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
      }

      .product-list {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 25px;
      }
      /* Horizontal scrolling row */
      .product-grid {
        display: flex;
        flex-wrap: nowrap;
        gap: 20px;
        overflow-x: auto;
        padding: 4px 2px 10px;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
      }
      .product-card {
        flex: 0 0 300px; /* fixed card width for horizontal layout */
        background: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-left: 4px solid #6a11cb;
        scroll-snap-align: start;
      }
      .product-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      .product-details h3 {
        margin: 0 0 10px;
        color: #6a11cb;
        font-size: 1.3rem;
        font-weight: 600;
      }
      .product-details p {
        margin: 5px 0;
        color: #555;
      }
      .btn-delete {
        background: linear-gradient(135deg, #ff6f61, #ff4757);
        color: white;
        border: none;
        padding: 8px 15px;
        font-size: 0.9em;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        align-self: flex-end;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-weight: 500;
      }
      .btn-delete:hover {
        background: linear-gradient(135deg, #ff4757, #ff3545);
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      }
      .no-products {
        text-align: center;
        color: #888;
        font-style: italic;
        font-size: 1.1rem;
        padding: 20px;
      }

      @media (max-width: 768px) {
        .product-grid {
          grid-template-columns: 1fr;
        }
        .container > h1:first-of-type {
          font-size: 1.6em;
          padding: 12px;
        }
        .container {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body class="seller-page">
    <nav class="navbar">
      <div class="brand">AutoCustomizer</div>
      <ul>
        <li><a href="/seller/dashboard.html">Dashboard</a></li>
        <li><a href="/seller/profileSettings">Profile Settings</a></li>
        <li><a href="/seller/productmanagement" class="active">Products</a></li>
        <li><a href="/seller/orders">Orders</a></li>

        <li><a href="/logout">Logout</a></li>
      </ul>
    </nav>

    <header>
      <h1>Product Management</h1>
    </header>

    <div class="container">
      <a
        href="/Seller/bulk-upload"
        class="btn-add"
        style="
          display: inline-block;
          width: auto;
          padding: 8px 16px;
          margin-bottom: 20px;
        "
        >Bulk Upload Products</a
      >

      <!-- Product Input Form -->
      <form
        action="/Seller/add-product"
        method="POST"
        enctype="multipart/form-data"
        class="product-form"
        id="productForm"
      >
        <div class="form-group">
          <label for="productName">Product Name:</label>
          <input type="text" id="productName" name="name" required />
        </div>
        <div class="form-group">
          <label for="productPrice">Product Price (â‚¹):</label>
          <input
            type="number"
            id="productPrice"
            name="price"
            step="0.01"
            required
          />
        </div>
        <div class="form-group">
          <label for="productDescription">Product Description:</label>
          <textarea
            id="productDescription"
            name="description"
            rows="3"
            required
          ></textarea>
        </div>
        <div class="form-group">
          <label for="productCategory">Product Category:</label>
          <input type="text" id="productCategory" name="category" required />
        </div>
        <div class="form-group">
          <label for="productBrand">Product Brand:</label>
          <input type="text" id="productBrand" name="brand" required />
        </div>
        <div class="form-group">
          <label for="productQuantity">Product Quantity:</label>
          <input type="number" id="productQuantity" name="quantity" required />
        </div>
        <div class="form-group">
          <label for="productSKU">Product SKU:</label>
          <input
            type="text"
            id="productSKU"
            name="sku"
            maxlength="6"
            required
          />
        </div>
        <div class="form-group">
          <label for="compatibility">Compatibility</label>
          <input
            type="text"
            class="form-control"
            id="compatibility"
            name="compatibility"
            placeholder="Enter compatible devices or models"
          />
        </div>
        <div class="form-group">
          <label for="productImage">Product Image:</label>
          <input
            type="file"
            id="productImage"
            name="image"
            accept="image/*"
            required
          />
        </div>
        <button type="submit" class="btn-add">Add Product</button>
      </form>

      <!-- Product List -->
      <div class="product-list">
        <h2>Product List</h2>
        <div id="productsWrap">
          <p>Loading products...</p>
        </div>
      </div>
    </div>

    <footer class="seller-footer">
      <p>&copy; 2025 AutoCustomizer | All Rights Reserved</p>
    </footer>

    <script>
      document
        .getElementById("productForm")
        .addEventListener("submit", function (event) {
          if (!validateForm()) {
            event.preventDefault();
          }
        });
      function validateForm() {
        const fields = [
          document.getElementById("productName"),
          document.getElementById("productCategory"),
          document.getElementById("productBrand"),
          document.getElementById("productDescription"),
          document.getElementById("productSKU"),
        ];
        for (const field of fields) {
          if (!field.value.trim()) {
            alert(
              `Please enter a valid ${field.previousElementSibling.innerText}.`
            );
            return false;
          }
        }
        const productPrice = document.getElementById("productPrice");
        const productQuantity = document.getElementById("productQuantity");
        fields[0].value = fields[0].value.toUpperCase();
        fields[1].value = fields[1].value.toUpperCase();
        if (!Number.isInteger(parseFloat(productQuantity.value))) {
          alert("Quantity must be an integer.");
          return false;
        }
        const priceRegex = /^\d+(\.\d{1,2})?$/;
        if (!priceRegex.test(productPrice.value)) {
          alert("Price must be a number with up to 2 decimal places.");
          return false;
        }
        if (fields[4].value.length !== 6) {
          alert("SKU must be exactly 6 characters.");
          return false;
        }
        return true;
      }

      async function loadProducts() {
        const wrap = document.getElementById("productsWrap");
        try {
          const res = await fetch("/seller/api/products", {
            headers: { Accept: "application/json" },
          });
          if (res.status === 401) {
            window.location.href = "/login";
            return;
          }
          const data = await res.json();
          if (!data.success)
            throw new Error(data.message || "Failed to load products");
          const list = data.products || [];
          if (!list.length) {
            wrap.innerHTML = '<p class="no-products">No products found.</p>';
            return;
          }
          const cards = list
            .map((p) => {
              const img = p.image
                ? `<img src="${p.image}" alt="${p.name}" style="width:100%;height:200px;object-fit:cover;border-radius:8px;margin-bottom:12px;"/>`
                : "";
              return `<div class="product-card">
              <div class="product-details">
                <h3>${p.name || ""}</h3>
                <p><strong>Price:</strong> â‚¹${p.price ?? ""}</p>
                <p><strong>Description:</strong> ${p.description || ""}</p>
                <p><strong>Category:</strong> ${p.category || ""}</p>
                <p><strong>Brand:</strong> ${p.brand || ""}</p>
                <p><strong>Quantity:</strong> ${p.quantity ?? ""}</p>
                <p><strong>SKU:</strong> ${p.sku || ""}</p>
                ${img}
              </div>
              <form action="/Seller/delete-product/${p._id}" method="POST">
                <button type="submit" class="btn-delete">Delete</button>
              </form>
            </div>`;
            })
            .join("");
          wrap.innerHTML = `<div class="product-grid">${cards}</div>`;
        } catch (err) {
          console.error(err);
          wrap.innerHTML =
            '<p style="color:#e74c3c;">Failed to load products.</p>';
        }
      }

      document.addEventListener("DOMContentLoaded", loadProducts);
    </script>
  </body>
</html>
